<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>[Proposal] Expose GeoLocation to Service Workers</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>
  
  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="66" alt="WICG" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">A partial archive of discourse.wicg.io as of Thursday February 08, 2024.</div>
    <h1 class="topic-title">[Proposal] Expose GeoLocation to Service Workers</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1584_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">valeriob</div>
          <div class="creation_date">2018-02-12</div>
          <div class="post_content">
<p>Scenario:</p>
<ul>
<li>location tracking : push event on location changed</li>
<li>geofencing events : push event on fence enter/leave</li>
<li>SW receives a push event, and my handler wants to check the current geolocation so I can warn the user about a potential nasty weather issue in their area.</li>
</ul>
<p>Follow up of
<aside class="onebox githubissue">
<header class="source">
<a href="https://github.com/w3c/ServiceWorker/issues/745#issuecomment-364863098" rel="nofollow noopener" target="_blank">github.com/w3c/ServiceWorker</a>
</header>
<article class="onebox-body">
<a href="https://github.com/joemarini" rel="nofollow noopener">
<img class="thumbnail onebox-avatar" height="96" src="https://avatars1.githubusercontent.com/u/822311?v=2&amp;s=96" width="96"/>
</a>
<h4><a href="https://github.com/w3c/ServiceWorker/issues/745#issuecomment-364863098" rel="nofollow noopener" target="_blank">Issue: Expose GeoLocation to workers</a></h4>
<div class="date" style="margin-top:10px;">
<div class="user" style="margin-top:10px;">
	opened by <a href="https://github.com/joemarini" rel="nofollow noopener" target="_blank">joemarini</a>
	on <a href="https://github.com/w3c/ServiceWorker/issues/745#issuecomment-364863098" rel="nofollow noopener" target="_blank">2015-09-04</a>
</div>
<div class="user">
	closed by <a href="https://github.com/slightlyoff" rel="nofollow noopener" target="_blank">slightlyoff</a>
	on <a href="https://github.com/w3c/ServiceWorker/issues/745#issuecomment-364863098" rel="nofollow noopener" target="_blank">2016-07-15</a>
</div>
</div>
<pre class="content" style="white-space: pre-wrap;">Scenario: SW receives a push event, and my handler wants to check the current geolocation so I can warn the user...</pre>
<div class="labels">
</div>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2421_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">marcosc</div>
          <div class="creation_date">2018-02-12</div>
          <div class="post_content">
<p>So, let’s generalize this to use cases and not talk about how it would be done. Basically, a web app wants to be notified when it enters or leaves a geofence, right?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1584_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">valeriob</div>
          <div class="creation_date">2018-02-12</div>
          <div class="post_content">
<p>Yes, and also when the position changes like Geolocation.watchPosition</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2421_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">marcosc</div>
          <div class="creation_date">2018-02-12</div>
          <div class="post_content">
<p>Ok, so, just noting that we’ve attempted to have discussion around this a few times and they’ve been sadly derailed (we’ve banned the individual who keeps poisoning it).</p>
<p>Nonetheless, browser makers haven’t been very enthusiastic about exposing this functionality to date. However, listing use cases and apps that would benefit from this would be great (or even discussing native apps that are successfully making use of this functionality), for when browser folks eventually get around to prioritizing this.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1585_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">merlinnot</div>
          <div class="creation_date">2018-02-17</div>
          <div class="post_content">
<p>You can find some use cases <a href="https://github.com/w3c/ServiceWorker/issues/745#issuecomment-186008849" rel="nofollow noopener">here</a>.</p>
<p>Some successful apps that could leverage this feature: Uber, Runtastic, smart home apps, everything for vehicle telematics industry.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Stephan_Kolle</div>
          <div class="creation_date">2018-02-21</div>
          <div class="post_content">
<ul>
<li>Retail websites that lists stock available in the current store a user is in.</li>
<li>The in store (brick and mortar) position of a item, a user I currently looking at in the stores webshop</li>
</ul>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1597_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">tomayac</div>
          <div class="creation_date">2018-02-21</div>
          <div class="post_content">
<p>Just to highlight and remind again what <span class="mention">@jakearchibald</span> <a href="https://github.com/w3c/ServiceWorker/issues/745#issuecomment-306432323" rel="nofollow noopener">wrote</a>:</p>
<p><em>“To clarify, I’m referring [in saying service workers would not be well suited] to the kind of geo tracking that an exercise tracker would need. Geofencing is a different thing, and does kinda fit with service worker’s model.”</em></p>
<p>So summarizing, where Service Workers <em>could</em> work:</p>
<ul>
<li>
<img alt=":x:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/x.png?v=5" title=":x:"/> Geotracking, e.g., track a run and see an accurate GPS trace.</li>
<li>
<img alt=":white_check_mark:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/white_check_mark.png?v=5" title=":white_check_mark:"/> Geofencing, e.g., remind me to buy some milk when I pass by the supermarket.</li>
</ul>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-21</div>
          <div class="post_content">
<p>The big use cases in my mind, would be fleet tracking, apps like fitness tracking, and even geo-caching. Those would be present day use cases. You could even include (these are from another users post on github) safety bulletin broadcasts.
I think that we have the basics of what is needed from the GeoLocation API, we can get single points, or we can get a continuous stream of points. I think (Sorry this is getting more towards implementation than I wanted) we really just need a better way of consuming that data. Im not sure that ServiceWorker is the place to have it. Mostly because ServiceWorker will already handle the network side of things if we need to send data back to the server. What we need is something that will proces the data stream into more relevant events.
I think the major problem to solve is the hurdle that is the word “Tracking”, and the perceived privacy implications.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-21</div>
          <div class="post_content">
<p>ServiceWorker is an abstraction between the network and your app, it is not a catch all for processing background data. It has to be periodic event driven, and network related. Unfortunately GPS data is effectively NOT periodic. Its continuous.
Now if there was a companion processor that broke down the stream into usable relevant events that ServiceWorker would then react to to say, cache a log, then I would agree.
On the surface Ill agree that ServiceWorker is the closest to what we need for a background processor, but if we mangle it to fit this use case we will open a pandoras box that will end up with serviceworkers getting locked down by users and we are back to using appcache. You don’t want that do you?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-21</div>
          <div class="post_content">
<p><span class="mention">@Richard_Maher</span>  To directly respond to your link and why tha’ts not fact, its because the link you presented, is to source developed by you to prove a point. It does not consider any alternatives other than what you have deemed as a best course of action. That’s like writing a paper and citing yourself as a reference. "You should believe me, because I believe me!"
Hence me re framing it as opinion. Still valid, and worthy of consideration. But as opinion it invites discussion. As fact it ends discussion.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-21</div>
          <div class="post_content">
<p>I would love to see the ability to define a resolution (distance delta and/or time delta) and have an event fire when those conditions are met. Its not a constant stream of position data, but a periodic stream, with predictable intervals (I want to know if the position changes by 5 meters or what position there is after 10 seconds)
So we can track movement (Like fleet management), We know where the fleet was, how long it stopped and loitered, and what route it used to get from a to b.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-22</div>
          <div class="post_content">
<p><span class="mention">@Richard_Maher</span> I won’t brand you for quoting colloquialisms, I like to think I am more understanding than that, however I would prefer you chose one that had a parallel.</p>
<p>Ill look deeper when I get home from work, however, even in your code it references a mythical beast;  “This module simulates the work that needs to be done by the UA or SW daemon in order to facilitate background geolocation on the web.”</p>
<p>It is precisely the SW Daemon that I would like to focus on. Since we have to define that, then we might as well do it right and not have preconceptions. I wouldn’t rule out that ServiceWorker might be a great place for part of it, but definitely not all of it, and I’m just not convinced that any of it fits. Despite the title of the proposal, I think there is a far more elegant solution yet to be found.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-22</div>
          <div class="post_content">
<p><span class="mention">@Richard_Maher</span> So I need to admit a confusion. Based on all my reading and conversations with others, I came to believe that serviceworker was not a good fit for geolocation… then based on your suggestion of reading the extensibility section, I decided to re-read the entirety of the spec, and I find this:</p>
<blockquote>
<p>Service workers are generic, event-driven, time-limited script contexts that run at an origin. These properties make them natural endpoints for a range of runtime services that may outlive the context of a particular document, e.g. handling push notifications, background data synchronization, responding to resource requests from other origins, or receiving centralized updates to expensive-to-calculate data (e.g., geolocation or gyroscope).</p>
</blockquote>
<p>Now I’m at a loss, if I am reading that paragraph correctly, it is explicitly noting geolocation as a service that serviceworkers are a natural endpoint. So at some point the spec writers believed that it was not only possible, but it would be a good fit.
Im wondering what made them change their minds. <span class="mention">@marcosc</span> can you provide some insight? It would be helpful for shaping the continuing conversation?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-25</div>
          <div class="post_content">
<p>You are correct, geolocation is out of scope for the generic sensor api. as it is a specialized sensor. Also I dont think that geolocation should be in the wake lock api. wake lock is something that a a geolocation process would use to maintain wake or cpu activity.
I continue to look deeper, peeling off the the layers of the onion.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1597_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">tomayac</div>
          <div class="creation_date">2018-02-26</div>
          <div class="post_content">
<p>Collecting a number of use cases from (anonymized but real) partners:</p>
<ul>
<li>
<strong><img alt=":house:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/house.png?v=5" title=":house:"/> Real Estate:</strong> Notifying you of nearby neighborhoods you’re passing that might fit your search criteria.</li>
<li>
<strong><img alt=":shopping:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/shopping.png?v=5" title=":shopping:"/> Retail:</strong> You have to be in a certain geofence to be eligible for various sales. Localized coupons. Connect the in-store experience. Let you know something you’ve looked at before is actually available for pick up nearby.</li>
<li>
<strong><img alt=":baggage_claim:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/baggage_claim.png?v=5" title=":baggage_claim:"/> Travel:</strong> Automatic delivery of check-in experience once you’re in boundaries of hotel/airport. Last mile confirmation of location/check-in. Show venue specific data like WiFi passwords etc. only within geofence boundaries.</li>
<li>
<strong><img alt=":tickets:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/tickets.png?v=5" title=":tickets:"/> Ticketing:</strong> Notification with ticket QR/bar code once you’re in boundaries of event location.</li>
<li>
<strong><img alt=":red_car:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/red_car.png?v=5" title=":red_car:"/> Car Rental:</strong> Notification when you land at airport or approach rental facility with car pickup details.</li>
<li>
<strong><img alt=":taxi:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/taxi.png?v=5" title=":taxi:"/> Ride Share:</strong> Notification when your driver approaches the pick-up point.</li>
</ul>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/875_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">kenchris</div>
          <div class="creation_date">2018-02-26</div>
          <div class="post_content">
<p>(tried to delete :))</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-26</div>
          <div class="post_content">
<p><span class="mention">@Richard_Maher</span> Good luck storming the castle!</p>
<p>I would suggest you look at the <a href="https://wicg.github.io/geolocation-sensor/" rel="nofollow noopener">Geolocation Sensor API</a> working group.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1599_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">robbie-mac</div>
          <div class="creation_date">2018-02-27</div>
          <div class="post_content">
<p>not the Generic Sensor API, the Specific Geolocation Sensor API. That would be the place to get a connection with serviceworker. They cant claim geolocation doesnt belong in a Geolocation Sensor API.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2421_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">marcosc</div>
          <div class="creation_date">2018-02-27</div>
          <div class="post_content">
<p>Slow and steady, <span class="mention">@Richard_Maher</span>. <span class="mention">@tomayac</span> list of use cases is a great start. Expanding on how those are currently solved in native apps would be really helpful.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1585_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">merlinnot</div>
          <div class="creation_date">2018-02-27</div>
          <div class="post_content">
<p>I actually took time to read every single word in this thread. And it strikes me how complicated thing it appears to be, when it’s so easy in reality. Let me point out a few things guys:</p>
<ul>
<li>PWAs are meant to compete with native apps (not only on mobile devices!), so they should and will provide more and more access to the native APIs. Geolocation is one of them.</li>
<li>Much smarter guys than us already figured out how to make an API for this the most efficient in terms of user experience, battery etc. (<a href="https://developer.apple.com/documentation/corelocation/cllocationmanager" rel="nofollow noopener">iOS</a>, <a href="https://developer.android.com/reference/android/location/LocationManager.html" rel="nofollow noopener">Android</a>)</li>
<li>Users already use apps which track geolocation in the background, they want to use them, they’re happy with them. We ask for permission, they grant it or not, they have a little icon in the status bar. Everyone happy.</li>
</ul>
<p>Can’t we just make the spec for this and see it easily implemented in browsers (UA guys will more or less forward the events from the location managers and we’re good).</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>
