<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Add event when browser process is closing</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>
  
  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="66" alt="WICG" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">A partial archive of discourse.wicg.io as of Thursday February 08, 2024.</div>
    <h1 class="topic-title">Add event when browser process is closing</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Cristian_Lorenzetto</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>A new event when user is closing the browser process.
It can be very usefull when a service worker can be pushed or not.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1137_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Garbee</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>What is a use-case for adding this kind of event? You should always assume a SW can be killed at any moment by the browser as a part of normal resource management.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Cristian_Lorenzetto</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>It is a case not frequent and anyway also when you kill a process you can execute a procedure before to exiting.</p>
<p>Instead to send periodic keep alive every minute to server for knowing when a user is online … you can send just a ajax when it happens this event. It consumes less bandwith and not overload server with many useless requests.
You can send a forced ajax request every hour.
if no keepalive request after alive … user session is deleted. This case permits to handle when you kill a process. Anyway it is a case very rare.
Normaly server receives just a call for each user.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1137_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Garbee</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>You shouldn’t use a SW to keep sessions alive.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Cristian_Lorenzetto</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>if i need to know if a user is online or nor ? how to do? Are you understanding what i m writing or you are following you thoughts? <img alt=":slight_smile:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:"/> I want to know when a user is online or not.Session cookies is not for to know when a user is online.I wont to know when user is in my server domain. I want simply to know when user has browser opened. Dont be confused <img alt=":slight_smile:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2455_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">DanielHerr</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>Don’t push notifications get queued for the next time the user is online?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Cristian_Lorenzetto</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>yes i want push message just if the user is online … not when he will be online (and it is not granted he will be  online).The ttl in the queue has  a limit so it is not granted it will be delivered in any case. limit can be also 3 days.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1137_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Garbee</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<aside class="quote" data-post="3" data-topic="2041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="//discourse.wicg.io/letter_avatar_proxy/v2/letter/c/3da27b/40.png" width="20"/> Cristian_Lorenzetto:</div>
<blockquote>
<p>if no keepalive request after alive … user session is deleted</p>
</blockquote>
</aside>
<p>I am following what you’re saying. So either you didn’t meant what you said a moment ago or you don’t understand sessions.</p>
<aside class="quote" data-post="5" data-topic="2041">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="//discourse.wicg.io/letter_avatar_proxy/v2/letter/c/3da27b/40.png" width="20"/> Cristian_Lorenzetto:</div>
<blockquote>
<p>if i need to know if a user is online or nor ?</p>
</blockquote>
</aside>
<p><code>navigator.onLine</code> to check it pragmatically or you can use the online/offline navigator events to know when their network condition changes (although you won’t know when they go offline, just when they come back online.)</p>
<p>Using a SW to ping the server that the user is still there doesn’t seem like an appropriate use of a SW. There are numerous other ways to handle session killing that existed before SW and still work just fine.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Cristian_Lorenzetto</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>you are a bit confused. DanielHerr understood all. You didnt <img alt=":slight_smile:" class="emoji" src="//discourse.wicg.io/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:"/> . online event tell if the connection is connected, not if the browser is closed/opened.
using online you could to know maybe when the user is starting the session not when he is closing it.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1137_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Garbee</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>If you want to know when the <em>page</em> is open/closed you use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API" rel="nofollow noopener">Page Visibility API</a>. The browser could be up and your SW running but the user <strong>may</strong> not have an active open session on the browser side.</p>
<p>You otherwise have no way of knowing if the browser is open/close, as they are able to run in the background of a users system.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Cristian_Lorenzetto</div>
          <div class="creation_date">2017-03-01</div>
          <div class="post_content">
<p>You continues to not understand. Page visibility tell when you minimize/mazimize the window(window where the domain is). Not when you close the browser.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2421_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">marcosc</div>
          <div class="creation_date">2017-03-02</div>
          <div class="post_content">
<p>There are a few APIs that already do this, like “unload” event. There is also the beacon API: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon">https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon</a></p>
<p>For service workers, maybe background sync would help?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/840_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">tomhodgins</div>
          <div class="creation_date">2017-03-02</div>
          <div class="post_content">
<p>I’ve used <code>beforeunload</code> for this sort of last-chance-before-closing functionality: <a href="https://developer.mozilla.org/en/docs/Web/Events/beforeunload" rel="nofollow noopener">https://developer.mozilla.org/en/docs/Web/Events/beforeunload</a></p>
<p>I’m not familiar with the serviceworkers though, would those be killed before <code>beforeunload</code> happens?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Cristian_Lorenzetto</div>
          <div class="creation_date">2017-03-03</div>
          <div class="post_content">
<p>But here there are esperts and developers or junior people?
I m reading absurd comments.
beforeunload tells when a user in your domain is closing the window. If my site is A , and user is going in site B , user is not closing the browser but beforeevent is triggered passing from A to B or i close tab and i go in another site.
beforeunload and sendbeacon  are for solving other problems.<br/>
Before to write it is necessary to read with attention the assertion of the topic.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1177_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">phistuck</div>
          <div class="creation_date">2017-03-30</div>
          <div class="post_content">
<p>I believe <code>sendBeacon</code> is not guaranteed to actually send the request before the browser exits. It is possible that it will be sent when the browser is launched next (I am not sure browsers currently implement that, but the specification lets browsers do that if they like, if I remember correctly). So that does not help in the case of Cristian.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1177_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">phistuck</div>
          <div class="creation_date">2017-03-30</div>
          <div class="post_content">
<p>So you want to track the online status of a browser (not of a user, since it might not have any tab open other than, for example, the Chrome “New Tab” tab and since a different person can be using the browser), right?</p>
<p>Did you intend for it to be a service worker event, or a regular event (to which HTML documents can listen)?</p>
<p>If you can come up with a solid use case, that would help stir this discussion in the right direction. So far, you mentioned that you could “push a service worker” depending on whether the browser is exiting or not. Perhaps you meant push notifications?
If so, can you come up with a solid use case for sending push notifications only when the browser is running?</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>
